# 댓글 정확 드롭 이동 API 계획

## 배경/문제
- 현재 댓글/답글 드래그 이동은 `UP/DOWN` 단위 API를 반복 호출하는 방식이다.
- 드롭 위치가 명확해도 실제 이동은 여러 번 호출/계산에 의존하여 지연과 오차가 발생한다.
- 사용자 요구는 “드롭 위치 = 실제 이동 위치”의 일치이며, 이를 위해 단일 이동 API가 필요하다.

## 목표
- 드롭 위치 기준으로 댓글/답글을 한 번에 이동하는 API를 제공한다.
- 프론트는 드롭 위치 인덱스를 서버에 전달하고, 서버가 정확히 재정렬한다.
- 기존 `UP/DOWN` API는 하위 호환을 위해 유지한다.

## 범위
- 포함: 백엔드 이동 API 추가, 정렬 로직 보완, 프론트 드롭 요청 방식 변경
- 제외: 기존 `UP/DOWN` API 제거, 데이터 모델 구조 대변경

## 현재 동작 정리
- 클라이언트는 `moveEntry(id, direction)`로 상하 1칸 이동만 요청 가능하다.
- 드래그 이동은 이 API를 여러 번 호출해 목표 위치로 이동한다.
- 서버는 댓글 정렬을 `orderIndex` 기반으로 관리한다.

## 개선 방향
- 서버에 목표 위치를 직접 전달하는 API(예: `targetIndex` 또는 `beforeEntryId/afterEntryId`)를 추가한다.
- 서버에서 동일 스레드 내 정렬을 재계산하고 저장한다.
- 프론트는 드롭 위치 정보를 API 파라미터로 전달한다.

## 단계별 계획
- 1단계: API 설계 확정
  - 요청 스키마를 `targetIndex` 또는 `beforeEntryId/afterEntryId` 중 하나로 결정.
  - 완료 기준: 요청/응답 형식 합의 완료.
- 2단계: 백엔드 구현
  - 이동 대상의 스레드 범위를 검증.
  - 동일 스레드 내에서 `orderIndex` 재정렬.
  - 완료 기준: 단일 호출로 위치 이동 가능.
- 3단계: 프론트 연동
  - 드롭 위치 인덱스를 계산해 새 API 호출.
  - 기존 반복 호출 로직 제거.
  - 완료 기준: 드롭 위치와 실제 위치가 일치.
- 4단계: 회귀 확인
  - 기존 `UP/DOWN` 버튼 및 다른 정렬 로직 정상 동작 확인.
  - 완료 기준: 기존 기능 회귀 없음.

## 리스크 및 대응
- 대량 재정렬 시 성능 저하 가능.
  - 대응: 인접 재정렬 알고리즘 적용 또는 필요 시 범위 업데이트.
- 클라이언트가 잘못된 인덱스를 보낼 수 있음.
  - 대응: 서버에서 범위 검증 및 보정.

## 검증 계획
- 수동 테스트
  - 드래그 드롭으로 원하는 위치에 정확히 이동하는지 확인.
  - 답글 이동 시에도 위치와 계층이 의도대로 유지되는지 확인.
  - 기존 상/하 이동 API 정상 동작 확인.
