# 상대경로 API 및 Nginx 프록시 계획

## 배경/문제
- 프론트가 API 기본값을 `http://localhost:28080` 절대경로로 사용하고 있음
- 운영 환경에서 도메인/포트가 달라지면 매번 환경변수를 맞춰야 하며, CORS 이슈가 발생할 수 있음

## 목표
- 프론트는 상대경로(`/api` 등)로 API를 호출
- Nginx가 프론트 정적 파일과 API 리버스 프록시를 동일 오리진에서 제공

## 범위
- 포함: 프론트 API base URL 상대경로화, Nginx 리버스 프록시 설정, `docker-compose.yml` 수정, 컨테이너 구동 커맨드 실행, 관련 문서/환경 설정 반영
- 제외: 백엔드 API 경로 구조 변경, 인증/보안 정책 재설계

## 현재 동작 정리
- 프론트: `VITE_API_BASE_URL` 없을 시 `http://localhost:28080` 사용
- 백엔드: 기본 포트 `28080`, CORS 허용 오리진 설정 존재
- 인프라: Nginx 설정/배포 구조 확인 필요

## 개선 방향
- 프론트는 기본값을 상대경로(`/api`)로 변경
- Nginx에서 `/api` → 백엔드로 프록시, 나머지는 정적 파일 서빙
- 로컬/배포 환경을 문서로 명확히 구분

## 단계별 계획
- Step 1: 기존 배포/인프라 구조 확인
  - 변경 대상 디렉토리(예: `infra`, `docker-compose`) 확인
  - 완료 기준: Nginx 적용 위치와 실행 방식 파악
- Step 2: 프론트 API base URL 상대경로화
  - 기본값을 `/api`로 변경
  - 완료 기준: 환경변수 없이도 상대경로로 호출
- Step 3: Nginx 리버스 프록시 설정 추가/수정
  - `/api` 요청은 백엔드로 프록시, 나머지는 프론트 정적 파일
  - 완료 기준: 동일 오리진에서 프론트/백엔드 동작
- Step 4: `docker-compose.yml`에 Nginx/프론트/백엔드 구성 반영
  - 포트, 네트워크, 볼륨 설정 정리
  - 완료 기준: compose로 전체 구동 가능
- Step 5: 문서 및 운영 가이드 반영
  - 로컬/운영 환경 설정 차이와 실행 방법 정리
  - 완료 기준: README 또는 운영 문서에 반영

## 리스크 및 대응
- 리스크: 프록시 경로 충돌 또는 라우팅 누락
  - 대응: `/api` prefix 고정, 프론트 라우팅은 `try_files`로 처리
- 리스크: CORS 설정과 충돌
  - 대응: 동일 오리진 구성 시 CORS 최소화, 필요 시 설정 재확인

## 검증 계획
- 프론트에서 댓글/스레드 API 호출이 상대경로로 동작하는지 확인
- Nginx 환경에서 `/api/health` 등 간단한 엔드포인트 호출 확인
- 브라우저 네트워크 탭에서 동일 오리진 요청 여부 확인
- `docker-compose up`으로 서비스가 정상 기동되는지 확인
