# owner_username 제거 및 쿼리 정리 계획

## 배경/문제
- 현재 `owner_id` 전환이 완료되었지만 `owner_username` 컬럼은 호환 목적으로 유지 중이다.
- 컬럼 중복은 스키마 복잡성을 증가시키고 정합성 유지 비용을 높인다.

## 목표
- `threads`/`categories`에서 `owner_username` 컬럼을 제거한다.
- 관련 JPA 엔티티/쿼리/마이그레이션을 `owner_id` 기준으로 완전 전환한다.
- 남아있는 의존 코드를 정리해 스키마/코드 일관성을 확보한다.

## 범위
- 포함: 엔티티/서비스/리포지토리 정리, Flyway 마이그레이션
- 제외: 사용자명 변경 이력 관리, 사용자명 캐싱 정책

## 현재 동작 정리
- `owner_id`가 실사용 기준이며 조회/접근 통제는 UUID 기반으로 동작한다.
- `owner_username`은 스키마에만 남아 있고, 신규 생성 시에도 채워진다.

## 개선 방향
- 컬럼 제거 전 `owner_id` 기준 전환이 완료되었는지 정합성 확인.
- 마이그레이션에서 컬럼 제거 및 관련 인덱스/제약 정리.
- 엔티티/서비스에서 `owner_username` 저장 로직 제거.

## 단계별 계획
- 1단계: 코드 정리
  - 무엇을 변경: 엔티티/서비스에서 `owner_username` 필드 제거 및 저장 로직 제거
  - 완료 기준: 코드 컴파일 가능, `owner_username` 참조가 없도록 정리
- 2단계: 마이그레이션 추가
  - 무엇을 변경: 컬럼 제거 및 관련 인덱스/제약 정리
  - 완료 기준: 마이그레이션 적용 가능
- 3단계: 검증
  - 무엇을 변경: 없음
  - 완료 기준: 주요 API 동작 및 권한 검증 정상

## 리스크 및 대응
- 기존 시스템에서 `owner_username`에 의존하는 외부 쿼리가 있을 수 있음 → 사전 점검 필요
- 롤백 시 컬럼 복구가 필요 → 복구 SQL 가이드 제공

## 검증 계획
- 애플리케이션 부팅 및 기본 CRUD 테스트
- 사용자별 접근 차단 테스트
