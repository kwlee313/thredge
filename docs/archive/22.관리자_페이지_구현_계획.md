# 관리자 페이지 구현 계획

## 배경/문제
- 관리자 권한에 따라 관리 기능을 제공해야 하지만 현재 UI/API에 관리자 전용 기능이 없다.
- 사용자 목록 조회, 사용자 삭제, 신규 가입 허용 여부 제어가 필요한데 백엔드/프론트 모두 미구현 상태다.
- 인증은 세션 기반이지만 역할(Role) 정보가 없어 관리자 판단이 불가능하다.

## 목표
- 관리자 계정으로 로그인 시에만 관리 탭이 노출되고, 관리자 페이지에서 사용자 목록/삭제/가입 허용 여부를 제어할 수 있다.
- 일반 사용자는 기존 동작(로그인, 쓰레드 이용 등)에 영향 없이 사용 가능하다.
- 관리자 기능은 API와 UI 모두에서 권한 검증이 된다.

## 범위
- 포함: 관리자 Role 도입, 관리자 전용 API(사용자 목록/삭제/가입 허용 상태 조회·변경), 관리자 페이지 UI/라우팅, 관리자 탭 조건부 노출
- 제외: 상세 권한 관리(다중 Role/권한 매트릭스), 감사 로그, 다중 관리 UI 테마 변경

## 현재 동작 정리
- 인증: `/api/auth/login` 세션 로그인, `/api/auth/me`로 사용자 확인
- Role: `CustomUserDetailsService`에서 하드코딩된 `USER` Role만 제공
- 사용자: `users` 테이블에 username/password 등만 저장, Role 필드 없음
- 가입: 프론트는 `/api/auth/signup` 호출을 기대하지만 백엔드에 구현이 없다
- UI: 상단 네비게이션에 홈/아카이브/설정 탭만 존재

## 개선 방향
- 사용자 Role을 `USER`/`ADMIN`으로 명시하고 인증 응답에 포함한다.
- 관리 기능은 서버에서 관리자 권한을 검증하고, UI는 Role 기반으로 탭 노출 및 접근 제어한다.
- 신규 가입 허용 여부는 서버가 보관하는 설정 값으로 관리하며, 비허용 시 가입 요청을 차단한다.
- 운영 환경에서 스키마 변경이 필요하므로 마이그레이션 또는 수동 스키마 반영 계획을 명확히 한다.

## 단계별 계획
- 1단계: 백엔드 Role/설정 모델 설계
  - 변경: `UserEntity`에 Role 필드 추가, 가입 허용 설정을 저장할 엔티티/리포지토리 추가
  - 완료 기준: Role/설정 구조가 명확하고 API 설계 초안이 정리됨
- 2단계: 백엔드 관리자 API 및 권한 검증
  - 변경: 사용자 목록 조회, 사용자 삭제, 가입 허용 상태 조회·변경 API 추가
  - 완료 기준: 관리자 권한 없으면 접근 불가, 관리자 권한이면 정상 동작
- 3단계: 인증/응답 확장
  - 변경: `AuthResponse`에 Role(또는 isAdmin) 포함, `/api/auth/me` 및 로그인 응답에 반영
  - 완료 기준: 프론트에서 관리자 여부 판별 가능
- 4단계: 프론트 관리자 UI
  - 변경: 관리자 탭 추가, 관리자 페이지 라우팅, 사용자 목록/삭제/가입 허용 토글 UI 구현
  - 완료 기준: 관리자 로그인 시 관리 탭 노출, 기능 정상 동작
- 5단계: 가입 플로우 연동
  - 변경: 가입 허용이 꺼져 있을 때 `/api/auth/signup` 차단 및 UI 메시지 처리
  - 완료 기준: 가입 비허용 시 가입 실패/경고가 명확히 표시됨

## 리스크 및 대응
- 스키마 변경 리스크: 운영 환경에서 `ddl-auto: none`이라 자동 변경이 불가
  - 대응: 마이그레이션 스크립트 제공 또는 수동 반영 절차 정리
- 권한 누락 리스크: UI만 제한하고 API가 열릴 수 있음
  - 대응: 서버에서 Role 기반 접근 제어를 우선 구현
- 삭제 실수 리스크: 사용자 삭제는 복구 불가할 수 있음
  - 대응: UI에서 확인 모달/경고 문구 제공

## 검증 계획
- 관리자 계정으로 로그인 후 관리 탭 노출 여부 확인
- 관리자 페이지에서 사용자 목록 조회 및 삭제 동작 확인
- 가입 허용 토글 변경 후 가입 시도 결과 확인(허용/비허용)
- 일반 사용자로 로그인 시 관리 탭 미노출 및 API 접근 거부 확인
