# 카테고리_유저_스코프_분리_계획

## 배경/문제
- 현재 카테고리가 이름(name) 기준으로 전역 유니크 처리되어 사용자 간 충돌이 발생함
- 스레드/카테고리가 사용자 소유 개념 없이 공유되어, 사용자별 분리가 불가능함
- 카테고리 필터에서 특정 카테고리를 선택해도 기대한 스레드가 보이지 않는 문제가 발생함

## 목표
- 카테고리와 스레드를 사용자 스코프로 분리하여 유저 간 데이터가 섞이지 않도록 함
- 동일한 카테고리 이름을 서로 다른 사용자가 각각 보유할 수 있도록 함
- 모든 조회/생성/수정/삭제가 로그인 사용자 기준으로 동작하도록 보장함

## 범위
- 포함: 카테고리/스레드/엔트리의 사용자 소유 모델 추가, API 동작 수정, 마이그레이션 스크립트 적용
- 제외: 사용자 모델/인증 방식 자체의 대대적 개편, 프론트 UI 개편

## 현재 동작 정리
- `CategoryEntity`는 `name`이 전역 유니크로 설정되어 있음
- `ThreadEntity`와 `CategoryEntity`에 사용자 소유 관계가 없음
- 컨트롤러는 사용자 스코프 필터 없이 전체 데이터를 조회/반환함

## 개선 방향
- 카테고리와 스레드에 `owner`(사용자) 참조를 추가
- 카테고리 유니크 제약을 `(owner_id, name)`으로 변경
- 모든 조회/생성/수정/삭제는 인증 사용자 기준으로 필터링
- 기존 데이터는 마이그레이션 시 기본 사용자에 귀속(또는 전략 결정)

## 단계별 계획
- Phase 1: 스키마/엔티티 변경
  - `CategoryEntity`, `ThreadEntity`, `EntryEntity`에 `owner` 참조 추가
  - DB 마이그레이션: `owner_id` 컬럼 추가, 유니크 제약 변경
  - 완료 기준: 애플리케이션이 컴파일되고 마이그레이션이 적용됨
- Phase 2: API 동작 수정
  - 카테고리/스레드/엔트리 CRUD에 사용자 필터 적용
  - 카테고리 조회/생성은 로그인 사용자 기준으로만 동작
  - 완료 기준: 타 사용자 데이터가 반환되지 않음
- Phase 3: 프론트 연동 확인
  - 카테고리 필터가 사용자 기준 데이터로 정상 동작 확인
  - 완료 기준: 동일 이름 카테고리라도 사용자 간 충돌 없음

## 리스크 및 대응
- 기존 데이터의 소유자 지정이 필요함
  - 대응: 마이그레이션 시 기본 사용자로 할당하거나, 사용자 지정 전략 정의
- 인증 정보가 없는 요청 처리
  - 대응: 인증 필수화 또는 기존 익명 사용자 정책 정의

## 검증 계획
- 마이그레이션 후 스키마 확인
- 두 사용자로 로그인하여 동일 카테고리 이름 생성 테스트
- 사용자 A의 스레드/카테고리가 사용자 B에게 보이지 않는지 확인
- 카테고리 필터에서 todo 선택 시 해당 스레드가 보이는지 확인
