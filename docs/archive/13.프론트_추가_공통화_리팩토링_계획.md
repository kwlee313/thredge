# 프론트 추가 공통화 리팩토링 계획

## 배경/문제
- 카테고리 CRUD 로직이 HomeFeed/ThreadCard/SettingsPage에 반복되어 유지보수가 어려움.
- ArchivePage의 스레드/엔트리 검색·필터 쿼리 흐름이 거의 동일하지만 중복 구현됨.
- ThreadCard/ThreadDetailPage의 쓰레드 편집 폼이 유사한데 UI/로직이 분산됨.
- React Query 키가 문자열 배열로 흩어져 있어 invalidate/캐시 관리가 번거로움.

## 목표
- 카테고리 CRUD와 아카이브 검색 흐름을 공통 훅/유틸로 묶어 중복을 제거한다.
- 쓰레드 편집 폼을 공통 컴포넌트로 분리해 UI/로직을 통일한다.
- React Query 키를 상수화해 쿼리 관리의 일관성을 높인다.

## 범위
- 포함
  - 카테고리 CRUD 공통 훅 작성 및 기존 호출부 교체
  - ArchivePage의 검색/필터 쿼리 공통 훅 적용
  - ThreadCard/ThreadDetailPage 편집 폼 공통 컴포넌트화
  - React Query 키 상수화 및 invalidate/queryKey 교체
- 제외
  - UI/디자인 대규모 변경
  - 백엔드 API 변경
  - 상태 관리 라이브러리 추가 도입

## 현재 동작 정리
- HomeFeed/ThreadCard에서 카테고리 생성/선택 로직을 직접 구성.
- SettingsPage에서 카테고리 CRUD 로직이 별도로 구현.
- ArchivePage에서 스레드/엔트리 검색/필터 쿼리가 중복 구조.
- React Query 키가 각 컴포넌트에 하드코딩되어 있음.

## 개선 방향
- 카테고리 관련 로직을 훅으로 통합하고, 필요한 옵션만 노출.
- ArchivePage의 쿼리/필터 분기를 범용 훅으로 캡슐화.
- 쓰레드 편집 UI를 공통 컴포넌트로 분리하고 props를 최소화.
- 쿼리 키는 상수/팩토리로 정의해 컴포넌트에서 재사용.

## 단계별 계획
- Phase 1: Query 키 상수화
  - `frontend/src/lib/queryKeys.ts` 신규 추가
  - 주요 쿼리 키를 상수/팩토리 형태로 정의
  - 기존 쿼리/invalidations에서 상수 사용
  - 완료 기준: 문자열 하드코딩 최소화
- Phase 2: 카테고리 CRUD 공통 훅
  - `useCategoryMutations` 훅 작성
  - HomeFeed/ThreadCard/SettingsPage에서 훅 사용으로 교체
  - 완료 기준: 카테고리 mutation 중복 제거
- Phase 3: ArchivePage 공통 훅
  - `useArchivedSearch` 훅 작성
  - 스레드/엔트리 검색/필터 로직 공통화
  - 완료 기준: ArchivePage 중복 분기 제거
- Phase 4: Thread 편집 폼 공통화
  - `ThreadEditor` 컴포넌트 분리
  - ThreadCard/ThreadDetailPage에서 재사용
  - 완료 기준: 편집 폼 UI/로직 단일화

## 리스크 및 대응
- 공통 훅/컴포넌트 도입으로 props가 복잡해질 수 있음
  - 대응: Home/Detail에서 실제 필요한 최소 props만 유지
- 쿼리 키 상수화 과정에서 invalidate 누락 가능
  - 대응: 변경 대상 키 리스트를 점검하며 교체

## 검증 계획
- 카테고리 생성/수정/삭제 후 목록/피드 반영 확인
- ArchivePage에서 스레드/엔트리 검색/복원 동작 확인
- Thread 편집/저장/취소 동작 확인
